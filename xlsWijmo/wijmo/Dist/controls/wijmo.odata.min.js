/*
    *
    * Wijmo Library 5.20162.188
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the Wijmo Commercial License.
    * sales@wijmo.com
    * http://wijmo.com/products/wijmo-5/license/
    *
    */
var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},wijmo;(function(n){var t;(function(t){'use strict';var i=function(t){function i(i,r,u){var f=this;t.call(this);this._count=0;this._sortOnServer=!0;this._pageOnServer=!0;this._filterOnServer=!0;this._inferDataTypes=!0;this.loading=new n.Event;this.loaded=new n.Event;this.error=new n.Event;this._url=n.asString(i,!1);this._tbl=n.asString(r);u&&n.copy(this,u);this.sortDescriptions.collectionChanged.addHandler(function(){f.sortOnServer&&f._getData()});this._getData()}return __extends(i,t),Object.defineProperty(i.prototype,"tableName",{get:function(){return this._tbl},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fields",{get:function(){return this._fields},set:function(t){this._fields!=t&&(this._fields=n.asArray(t),this._getData())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"requestHeaders",{get:function(){return this._requestHeaders},set:function(n){this._requestHeaders=n},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keys",{get:function(){return this._keys},set:function(t){this._keys=n.asArray(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dataTypes",{get:function(){return this._dataTypes},set:function(n){this._dataTypes=n},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"inferDataTypes",{get:function(){return this._inferDataTypes},set:function(t){this._inferDataTypes=n.asBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sortOnServer",{get:function(){return this._sortOnServer},set:function(t){t!=this._sortOnServer&&(this._sortOnServer=n.asBoolean(t),this._getData())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pageOnServer",{get:function(){return this._pageOnServer},set:function(t){t!=this._pageOnServer&&(this._pageOnServer=n.asBoolean(t),this.pageSize&&this._getData())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"filterOnServer",{get:function(){return this._filterOnServer},set:function(t){t!=this._filterOnServer&&(this._filterOnServer=n.asBoolean(t),this._getData())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"filterDefinition",{get:function(){return this._filterDef},set:function(t){t!=this._filterDef&&(this._filterDef=n.asString(t),this._getData())},enumerable:!0,configurable:!0}),i.prototype.updateFilterDefinition=function(t){this.filterOnServer&&n.grid&&n.grid.filter&&t instanceof n.grid.filter.FlexGridFilter&&(this.filterDefinition=this._asODataFilter(t))},Object.defineProperty(i.prototype,"oDataVersion",{get:function(){return this._odv},set:function(t){this._odv=n.asNumber(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isLoading",{get:function(){return this._loading},enumerable:!0,configurable:!0}),i.prototype.onLoading=function(n){this.loading.raise(this,n)},i.prototype.onLoaded=function(n){this.loaded.raise(this,n)},i.prototype.load=function(){this._getData()},i.prototype.onError=function(n){return this.error.raise(this,n),!n.cancel},i.prototype.commitNew=function(){var u=this,f={Accept:'application/json'},r,i,e;if(this.requestHeaders)for(r in this.requestHeaders)f[r]=this.requestHeaders[r];i=this.currentAddItem;i&&(e=this._getWriteUrl(),n.httpRequest(e,{method:'POST',requestHeaders:f,data:this._stringifyNumbers(i),success:function(n){var t=JSON.parse(n.response);u.keys.forEach(function(n){i[n]=t[n]});u.refresh()},error:this._error.bind(this)}));t.prototype.commitNew.call(this)},i.prototype.commitEdit=function(){var i=this.currentEditItem,r;!i||this.currentAddItem||this._sameContent(i,this._edtClone)||(r=this._getWriteUrl(this._edtClone),n.httpRequest(r,{method:'PUT',requestHeaders:this.requestHeaders,data:this._stringifyNumbers(i),error:this._error.bind(this)}));t.prototype.commitEdit.call(this)},i.prototype.remove=function(i){if(i&&i!=this.currentAddItem){var r=this._getWriteUrl(i);n.httpRequest(r,{method:'DELETE',requestHeaders:this.requestHeaders,error:this._error.bind(this)})}t.prototype.remove.call(this,i)},Object.defineProperty(i.prototype,"totalItemCount",{get:function(){return this.pageOnServer?this._count:this._view.length},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pageCount",{get:function(){return this.pageSize?Math.ceil(this.totalItemCount/this.pageSize):1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pageSize",{get:function(){return this._pgSz},set:function(t){t!=this._pgSz&&(this._pgSz=n.asInt(t),this.pageOnServer?(this._pgIdx=n.clamp(this._pgIdx,0,this.pageCount-1),this._getData()):this.refresh())},enumerable:!0,configurable:!0}),i.prototype.onPageChanging=function(n){return t.prototype.onPageChanging.call(this,n),!n.cancel&&this.pageOnServer&&this._getData(),!n.cancel},i.prototype._getPageView=function(){return this.pageOnServer?this._view:t.prototype._getPageView.call(this)},i.prototype._performRefresh=function(){var n=this._canFilter,i=this._canSort;this._canFilter=!this._filterOnServer;this._canSort=!this._sortOnServer;t.prototype._performRefresh.call(this);this._canFilter=n;this._canSort=i},i.prototype._storeItems=function(n,t){t?Array.prototype.push.apply(this.sourceCollection,n):this.sourceCollection=n},i.prototype._getReadUrl=function(n){var t=this._url;return t[t.length-1]!='/'&&(t+='/'),n?t=n.indexOf('http')==0?n:t+n:this._tbl&&(t+=this._tbl),t},i.prototype._getReadParams=function(n){var t={$format:'json'},i,r,u;if(this._tbl&&!n){if(this._odv<4?t.$inlinecount='allpages':t.$count=!0,this.fields&&(t.$select=this.fields.join(',')),this.sortOnServer&&this.sortDescriptions.length){for(i='',r=0;r<this.sortDescriptions.length;r++)u=this.sortDescriptions[r],i&&(i+=','),i+=u.property,u.ascending||(i+=' desc');t.$orderby=i}this.pageOnServer&&this.pageSize>0&&(t.$skip=this.pageIndex*this.pageSize,t.$top=this.pageSize);this.filterDefinition&&(t.$filter=this.filterDefinition)}return t},i.prototype._getData=function(t){var i=this;this._toGetData&&clearTimeout(this._toGetData);this._toGetData=setTimeout(function(){if(i._odv==null){i._getSchema();return}i._loading=!0;i.onLoading();var r=i._getReadUrl(t);n.httpRequest(r,{requestHeaders:i.requestHeaders,data:i._getReadParams(t),success:function(n){var r=JSON.parse(n.response),u=r.d?r.d.results:r.value,o=r.d?r.d.__count:r['odata.count']||r['@odata.count'],e,f;if(o!=null&&(i._count=parseInt(o)),t||i.inferDataTypes&&!i._dataTypesInferred&&(i._dataTypesInferred=i._getInferredDataTypes(u)),e=i.dataTypes?i.dataTypes:i._dataTypesInferred,e)for(f=0;f<u.length;f++)i._convertItem(e,u[f]);i._storeItems(u,t!=null);i.refresh();t=r.d?r.d.__next:r['odata.nextLink']||r['@odata.nextLink'];t?i._getData(t):(i._loading=!1,i.onLoaded())},error:function(t){if(i._loading=!1,i.onLoaded(),i.onError(new n.RequestErrorEventArgs(t)))throw'HttpRequest Error: '+t.status+' '+t.statusText;}})},100)},i.prototype._stringifyNumbers=function(t){var r,u,i;if(this._odv>=4)return t;r={};for(u in t)i=t[u],r[u]=n.isNumber(i)?i.toString():i;return r},i.prototype._convertItem=function(t,i){var u,f,r;for(u in t)f=t[u],r=i[u],r!=undefined&&(f===n.DataType.Date&&r&&r.indexOf('/Date(')==0&&(r=new Date(parseInt(r.substr(6)))),i[u]=n.changeType(r,f,null))},i.prototype._getInferredDataTypes=function(t){var u=null,f,r,e,o;if(t.length>0){for(f={},r=0;r<t.length&&r<10;r++)this._extend(f,t[r]);for(e in f)o=f[e],n.isString(o)&&o.match(i._rxDate)&&(u||(u={}),u[e]=n.DataType.Date)}return u},i.prototype._getServiceUrl=function(){var n=this._url;return n[n.length-1]!='/'&&(n+='/'),n},i.prototype._getSchema=function(){var r=this,t=this._getServiceUrl()+'$metadata';this._odv=i._odvCache[t];this._odv?this._getData():n.httpRequest(t,{requestHeaders:this.requestHeaders,success:function(n){var u=n.response.match(/<.*Version\s*=\s*"(.*)"\s*>/i),f=u?parseFloat(u[1]):4;i._odvCache[t]=r._odv=f},error:function(){i._odvCache[t]=r._odv=4},complete:function(){r._getData()}})},i.prototype._getWriteUrl=function(t){var i=this._getServiceUrl(),r;return i+=this._tbl,t&&(n.assert(this.keys&&this.keys.length>0,'write operations require keys.'),r=[],this.keys.forEach(function(i){n.assert(t[i]!=null,'key values cannot be null.');r.push(i+'='+t[i])}),i+='('+r.join(',')+')'),i},i.prototype._asODataFilter=function(n){for(var u,t,i='',r=0;r<n.grid.columns.length;r++)u=n.grid.columns[r],t=n.getColumnFilter(u,!1),t&&t.isActive&&(i&&(i+=' and '),t.conditionFilter&&t.conditionFilter.isActive?i+=this._asODataConditionFilter(t.conditionFilter):t.valueFilter&&t.valueFilter.isActive&&(i+=this._asODataValueFilter(t.valueFilter)));return i},i.prototype._asODataValueFilter=function(t){var i=t.column,e=i.binding,r='',u,f;for(u in t.showValues)f=n.changeType(u,i.dataType,i.format),r&&(r+=' or '),r+='('+e+' eq '+this._asODataValue(f,i.dataType)+')';return'('+r+')'},i.prototype._asODataConditionFilter=function(n){var t=this._asODataCondition(n,n.condition1);return n.condition2.operator!=null&&(t+=(n.and?' and ':' or ')+this._asODataCondition(n,n.condition2)),'('+t+')'},i.prototype._asODataCondition=function(n,t){var i=n.column.binding,r=this._asODataValue(t.value,n.column.dataType);switch(t.operator){case 0:return i+' eq '+r;case 1:return i+' ne '+r;case 2:return i+' gt '+r;case 3:return i+' gt '+r;case 4:return i+' lt '+r;case 5:return i+' le '+r;case 6:return'startswith('+i+','+r+')';case 7:return'endswith('+i+','+r+')';case 8:return this._odv>=4?'contains('+i+','+r+')':'substringof('+r.toLowerCase()+', tolower('+i+'))';case 9:return this._odv>=4?'not contains('+i+','+r+')':'not substringof('+r.toLowerCase()+', tolower('+i+'))'}},i.prototype._asODataValue=function(t,i){return n.isString(t)?"'"+t.replace(/'/g,"\'")+"'":n.isDate(t)?"datetime'"+t.toISOString()+"'":t!=null?t.toString():i==n.DataType.String?"''":null},i.prototype._error=function(t){if(this.onError(new n.RequestErrorEventArgs(t))){this._getData();throw'HttpRequest Error: '+t.status+' '+t.statusText;}},i._odvCache={},i._rxDate=/^\d{4}\-\d{2}\-\d{2}T\d{2}\:\d{2}\:\d{2}|\/Date\([\d\-]*?\)/,i}(n.collections.CollectionView);t.ODataCollectionView=i})(t=n.odata||(n.odata={}))})(wijmo||(wijmo={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){'use strict';var i=function(t){function i(n,i,r){r==null&&(r={});r.pageOnServer=!0;r.sortOnServer=!0;r.canGroup=!1;r.pageSize||(r.pageSize=100);t.call(this,n,i,r);this._data=[];this.sourceCollection=this._data;this._skip=0;this.setWindow(0,this.pageSize)}return __extends(i,t),i.prototype.setWindow=function(n,t){var i=this;this._toSetWindow&&clearTimeout(this._toSetWindow);this._toSetWindow=setTimeout(function(){i._toSetWindow=null;i._performSetWindow(n,t)},50)},Object.defineProperty(i.prototype,"pageOnServer",{get:function(){return!0},set:function(n){if(!n)throw'ODataVirtualCollectionView requires pageOnServer = true.';},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sortOnServer",{get:function(){return!0},set:function(t){if(!n.asBoolean(t))throw'ODataVirtualCollectionView requires sortOnServer = true.';},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"filterOnServer",{get:function(){return!0},set:function(t){if(!n.asBoolean(t))throw'ODataVirtualCollectionView requires filterOnServer = true.';},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"canGroup",{get:function(){return this._canGroup},set:function(t){if(n.asBoolean(t))throw'ODataVirtualCollectionView does not support grouping.';},enumerable:!0,configurable:!0}),i.prototype._performRefresh=function(){this.isLoading||(this._refresh=!0);t.prototype._performRefresh.call(this)},i.prototype._getReadParams=function(n){var i=t.prototype._getReadParams.call(this,n);return i.$skip=this._skip||0,i.$top=this.pageSize,i},i.prototype._storeItems=function(n,t){var r,i;if(this._refresh||this._data.length!=this.totalItemCount){for(this._data.length=this.totalItemCount,i=0;i<this._data.length;i++)this._data[i]=null;this._refresh=!1}for(t||(this._loadOffset=0),r=this._loadOffset+(this._skip||0),i=0;i<n.length;i++)this._data[i+r]=n[i];this._loadOffset+=n.length},i.prototype._performSetWindow=function(t,i){var e,u,f,r;for(t=n.asInt(t),i=n.asInt(i),n.assert(i>=t,'Start must be smaller than end.'),e=n.isNumber(this._start)&&t>this._start,this._start=t,this._end=i,u=!1,r=t;r<i&&r<this._data.length&&!u;r++)u=this._data[r]==null;if(u){for(f=Math.max(0,e?t:i-this.pageSize),r=f;r<this._data.length&&this._data[r]!=null;r++)f++;this._skip=f;this._getData()}},i}(t.ODataCollectionView);t.ODataVirtualCollectionView=i})(t=n.odata||(n.odata={}))}(wijmo||(wijmo={}))